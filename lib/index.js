var Lengths={paddingLeft:12,nodeWidth:180,statusHeight:18},Sizes={buttonSize:{width:40,height:48},contentSize:{width:Lengths.nodeWidth,height:42},childContentSize:{width:Lengths.nodeWidth,height:60},nodeSize:{width:Lengths.nodeWidth,height:90},nodeSizeWithChildren:{width:Lengths.nodeWidth,height:176}},Points={buttonPosition:{x:Lengths.nodeWidth-Sizes.buttonSize.width,y:0},contentPosition:{x:0,y:Sizes.buttonSize.height},infoPosition:{x:Lengths.paddingLeft,y:11},metricsPosition:{x:Lengths.paddingLeft,y:41},subtitlePosition:{x:Lengths.paddingLeft,y:23}},Rects={buttonRect:Object.assign({},Sizes.buttonSize,Points.buttonPosition),contentRect:Object.assign({},Sizes.contentSize,Points.contentPosition),childContentRect:Object.assign({},Sizes.childContentSize,Points.contentPosition),nodeRect:Object.assign({},Sizes.nodeSize,{left:-Sizes.nodeSize.width/2,right:Sizes.nodeSize.width/2,top:-Sizes.nodeSize.height/2,bottom:Sizes.nodeSize.height/2}),nodeRectWithChildren:Object.assign({},Sizes.nodeSizeWithChildren,{left:-Sizes.nodeSizeWithChildren.width/2,right:Sizes.nodeSizeWithChildren.width/2,top:-Sizes.nodeSizeWithChildren.height/2+Sizes.contentSize.height/3,bottom:Sizes.nodeSizeWithChildren.height/2+Sizes.contentSize.height/3})},Constants=Object.assign({},Lengths,Sizes,Points,Rects);export default Constants;
import Constants from'./constants';var getAngleFromPoints=function(a,b){var c=Math.atan2(b.y-a.y,b.x-a.x),d=180*c/Math.PI,e=0>d?360+d:d;return e},getPosition=function(a,b,c){var d=Math.round,e=3<arguments.length&&void 0!==arguments[3]&&arguments[3],f=e?2*d(a/90):d(a/45),g=b[f];return{id:g.id,x:c.x+g.x,y:c.y+g.y}},getPositions=function(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;return[{id:'r',x:a.right,y:0},{id:'br',x:a.right-b,y:a.bottom-b},{id:'b',x:0,y:a.bottom},{id:'bl',x:a.left+b,y:a.bottom-b},{id:'l',x:a.left,y:0},{id:'tl',x:a.left+b,y:a.top+b},{id:'t',x:0,y:a.top},{id:'tr',x:a.right-b,y:a.top+b},{id:'r',x:a.right,y:0}]},calculateLineLayout=function(a){var b=a.source,c=a.target,d=2,e=getPositions(b.nodeRect,d),f=getAngleFromPoints(b,c),g=getPosition(f,e,b),h=getPositions(c.nodeRect,d),i=getAngleFromPoints(c,g),j=getPosition(i,h,c),k=getAngleFromPoints(g,j);return{source:b,target:c,sourcePosition:g,targetPosition:j,arrowAngle:k}},getStatusesLength=function(a){return a.transitionalStatus?1:a.instanceStatuses.length},getStatusesHeight=function(a){var b=a.children?a.children.reduce(function(a,b){return a+getStatusesLength(b)},0):getStatusesLength(a);return b?Constants.statusHeight*b+6:0},getContentRect=function(a){var b=1<arguments.length&&arguments[1]!==void 0&&arguments[1],c=b?Constants.childContentSize:Constants.contentSize,d=c.height,e=d+getStatusesHeight(a);return Object.assign({},Constants.contentPosition,{width:c.width,height:e})},getNodeRect=function(a){var b=a.children?Constants.nodeSizeWithChildren:Constants.nodeSize,c=b.width,d=b.height,e=d+getStatusesHeight(a);return{left:-c/2,right:c/2,top:-d/2,bottom:e-d/2,width:c,height:e}};export{getContentRect,getNodeRect,calculateLineLayout};
var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_templateObject=_taggedTemplateLiteral(['\n  width: 100%;\n  height: 1000px;\n'],['\n  width: 100%;\n  height: 1000px;\n']);function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _taggedTemplateLiteral(a,b){return Object.freeze(Object.defineProperties(a,{raw:{value:Object.freeze(b)}}))}import React from'react';import{Svg}from'normalized-styled-components';import PropTypes from'prop-types';import difference from'lodash.difference';import differenceBy from'lodash.differenceby';import Constants from'./constants';import{createSimulation}from'./simulation';import TopologyNode from'./node';import TopologyLink from'./link';import TopologyLinkArrow from'./link/arrow';import{getNodeRect,calculateLineLayout}from'./functions';var StyledSvg=Svg.extend(_templateObject),Topology=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:'componentWillMount',value:function componentWillMount(){this.create(this.props)}},{key:'componentDidMount',value:function componentDidMount(){this.boundResize=this.handleResize.bind(this),window.addEventListener('resize',this.boundResize)}},{key:'componentWillUnmount',value:function componentWillUnmount(){window.removeEventListener('resize',this.boundResize)}},{key:'shouldComponentUpdate',value:function shouldComponentUpdate(){return!1}},{key:'getChangedConnections',value:function getChangedConnections(a,b){return b.reduce(function(b,c){if(b.added||b.removed)return b;var d=a.filter(function(a){return a.id===c.id}).shift(),e=difference(c.connections,d.connections).length;if(e)return{added:!0};var f=difference(d.connections,c.connections).length;return f?{removed:!0}:b},{})}},{key:'getNextLinks',value:function getNextLinks(a){var b=this.state.links;return b.reduce(function(b,c){var d=a.filter(function(a){return a.id===c.source.id});if(d.length){var e=d.shift(),f=a.filter(function(a){return a.id===c.target.id}).length,g=e.connections.filter(function(a){return a===c.target.id}).length;f&&g&&b.push(c)}return b},[])}},{key:'getNextNodes',value:function getNextNodes(a){var b=this.state.nodes;return b.reduce(function(b,c){var d=a.filter(function(a){return a.id===c.id}).length;return d&&b.push(c),b},[])}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(a){var b=this,c=a.services.sort(),d=c.filter(function(a){return a.connected}),e=c.filter(function(a){return!a.connected}),f=this.state.services;if(c.length>f.length)this.create(a);else if(c.length<=f.length){var g=differenceBy(f,c,'id'),h=differenceBy(c,f,'id');if(h.length||g.length!==f.length-c.length)this.create(a);else{var i=this.getChangedConnections(f,c);if(i.added)this.create(a);else if(g.length||i.removed){var j=this.getNextNodes(d),k=this.getNotConnectedNodes(e),l=this.getNextLinks(c);this.setState({services:c,links:l,nodes:j,notConnectedNodes:k},function(){return b.forceUpdate()})}else this.setState({services:c},function(){return b.forceUpdate()})}}}},{key:'getNotConnectedNodes',value:function getNotConnectedNodes(a){var b=this;return a.map(function(a,c){var d=b.getSvgSize(),e=a.isConsul?d.width-Constants.nodeSize.width:(Constants.nodeSize.width+10)*c;return{id:a.id,x:e,y:0}})}},{key:'handleResize',value:function handleResize(){this.create(this.props)}},{key:'create',value:function create(a){var b=this,c=a.services.sort(),d=c.filter(function(a){return a.connected}),e=c.filter(function(a){return!a.connected}),f=this.getSvgSize(),g=createSimulation(d,f),h=g.nodes,i=g.links,j=g.simulation,k=this.getNotConnectedNodes(e);this.setState({notConnectedNodes:k,nodes:h,links:i,simulation:j,services:c},function(){b.forceUpdate()})}},{key:'getSvgSize',value:function getSvgSize(){if(document.getElementById('topology-svg'))return document.getElementById('topology-svg').getBoundingClientRect();var a=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;return{width:a-48,height:1e3}}},{key:'constrainNodePosition',value:function constrainNodePosition(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]&&arguments[3],e=this.getSvgSize();return a<c.right+2?a=c.right+2:a>e.width+c.left-2&&(a=e.width+c.left-2),b<-c.top+2?b=-c.top+2:b>e.height-c.bottom-2&&(b=e.height-c.bottom-2),{x:a,y:b}}},{key:'findNode',value:function findNode(a){return this.state.nodes.reduce(function(b,c){return c.id===a?c:b},{})}},{key:'getConstrainedNodePosition',value:function getConstrainedNodePosition(a,b){var c=2<arguments.length&&void 0!==arguments[2]&&arguments[2],d=this.findNode(a);return this.constrainNodePosition(d.x,d.y,b,c)}},{key:'getNotConnectedNodePosition',value:function getNotConnectedNodePosition(a){return this.state.notConnectedNodes.filter(function(b){return b.id===a}).shift()}},{key:'findNodeData',value:function findNodeData(a,b){return a.filter(function(a){return a.id===b}).shift()}},{key:'setDragInfo',value:function setDragInfo(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};this.dragInfo={dragging:a,nodeId:b,position:c}}},{key:'render',value:function render(){var a=this,b=this.props,c=b.onQuickActionsClick,d=b.onNodeTitleClick,e=this.state,f=e.nodes,g=e.links,h=e.services,i=h.map(function(b){var c=getNodeRect(b),d=b.connected?a.getConstrainedNodePosition(b.id,c,b.children):a.getNotConnectedNodePosition(b.id);return Object.assign({},b,d,{nodeRect:c})}),j=g.map(function(b){return{source:a.findNodeData(i,b.source.id),target:a.findNodeData(i,b.target.id)}}).map(function(a,b){return calculateLineLayout(a,b)}),k=function(b,c){var d=b.changedTouches?b.changedTouches[0].pageX:b.clientX,e=b.changedTouches?b.changedTouches[0].pageY:b.clientY;a.setDragInfo(!0,c,{x:d,y:e})},l=function(b){if(a.dragInfo&&a.dragInfo.dragging){var c=b.changedTouches?b.changedTouches[0].pageX:b.clientX,d=b.changedTouches?b.changedTouches[0].pageY:b.clientY,e={x:c-a.dragInfo.position.x,y:d-a.dragInfo.position.y},g=f.map(function(b){return b.id===a.dragInfo.nodeId?Object.assign({},b,{x:b.x+e.x,y:b.y+e.y}):Object.assign({},b)});a.setState({nodes:g},function(){return a.forceUpdate()}),a.setDragInfo(!0,a.dragInfo.nodeId,{x:c,y:d})}},m=function(){a.setDragInfo(!1)},o=function(a,b){return React.createElement(TopologyNode,{key:b,data:a,index:b,onDragStart:k,onNodeTitleClick:d,onQuickActions:c})},n=function(a,b){return React.createElement(TopologyLink,{key:b,data:a,index:b})},p=function(a,b){return React.createElement(TopologyLinkArrow,{key:b,data:a,index:b})},q=this.dragInfo&&this.dragInfo.dragging?i.filter(function(b){return b.id!==a.dragInfo.nodeId}).map(function(a,b){return o(a,b)}):i.map(function(a,b){return o(a,b)}),r=j.map(function(a,b){return n(a,b)}),s=this.dragInfo&&this.dragInfo.dragging?j.filter(function(b){return b.target.id!==a.dragInfo.nodeId}).map(function(a,b){return p(a,b)}):j.map(function(a,b){return p(a,b)}),t=this.dragInfo&&this.dragInfo.dragging?o(i.reduce(function(b,c){return c.id===a.dragInfo.nodeId?c:b},{})):null,u=this.dragInfo&&this.dragInfo.dragging&&s.length!==r.length?p(j.reduce(function(b,c){return c.target.id===a.dragInfo.nodeId?c:b},{})):null;return React.createElement(StyledSvg,{onMouseMove:l,onTouchMove:l,onMouseUp:m,onTouchEnd:m,onTouchCancel:m,id:'topology-svg'},React.createElement('g',null,q),React.createElement('g',null,r),React.createElement('g',null,s),React.createElement('g',null,t),React.createElement('g',null,u))}}]),b}(React.Component);Topology.propTypes={onQuickActionsClick:PropTypes.func,onNodeTitleClick:PropTypes.func,services:PropTypes.array};export default Topology;export{default as TopologyNode}from'./node';export{default as TopologyLink}from'./link';
import React from'react';import PropTypes from'prop-types';import{GraphLinkCircle,GraphLinkArrowLine}from'./shapes';var GraphLinkArrow=function(a){var b=a.data,c=a.index,d=b.targetPosition,e=b.arrowAngle;return React.createElement('g',{transform:'translate('+d.x+', '+d.y+') rotate('+e+')'},React.createElement(GraphLinkCircle,{cx:0,cy:0,r:9}),React.createElement(GraphLinkArrowLine,{x1:-1,x2:2,y1:-3,y2:0}),React.createElement(GraphLinkArrowLine,{x1:-1,x2:2,y1:3,y2:0}))};GraphLinkArrow.propTypes={data:PropTypes.object.isRequired,index:PropTypes.number};export default GraphLinkArrow;
import React from'react';import PropTypes from'prop-types';import{GraphLinkLine}from'./shapes';var GraphLink=function(a){var b=a.data,c=a.index,d=b.sourcePosition,e=b.targetPosition;return React.createElement(GraphLinkLine,{x1:d.x,x2:e.x,y1:d.y,y2:e.y})};GraphLink.propTypes={data:PropTypes.object.isRequired,index:PropTypes.number};export default GraphLink;
var _templateObject=_taggedTemplateLiteral(['\n  stroke: ',';\n  stroke-width: 1.5;\n'],['\n  stroke: ',';\n  stroke-width: 1.5;\n']),_templateObject2=_taggedTemplateLiteral(['\n  stroke: ',';\n  fill: ',';\n  stroke-width: 1.5;\n'],['\n  stroke: ',';\n  fill: ',';\n  stroke-width: 1.5;\n']),_templateObject3=_taggedTemplateLiteral(['\n  stroke: ',';\n  stroke-width: 2;\n  stroke-linecap: round;\n'],['\n  stroke: ',';\n  stroke-width: 2;\n  stroke-linecap: round;\n']);function _taggedTemplateLiteral(a,b){return Object.freeze(Object.defineProperties(a,{raw:{value:Object.freeze(b)}}))}import styled from'styled-components';import{theme}from'joyent-ui-toolkit';export var GraphLinkLine=styled.line(_templateObject,theme.secondaryActive);export var GraphLinkCircle=styled.circle(_templateObject2,theme.secondaryActive,theme.secondary);export var GraphLinkArrowLine=styled.line(_templateObject3,theme.white);
import React from'react';import PropTypes from'prop-types';import Constants from'../constants';import{GraphLine,GraphButtonRect,GraphButtonCircle}from'./shapes';var NodeButton=function(a){var b=a.onButtonClick,c=a.index,d=a.isConsul,e=a.instancesActive,f=Constants.buttonRect,g=f.x,h=f.y,i=f.width,j=f.height,k=2,l=2,m=[1,2,3].map(function(a,b){return React.createElement(GraphButtonCircle,{cx:i/2,cy:(j-4*k-2*l)/2+(2*k+l)*b,key:b,r:2,consul:d,active:e})});return React.createElement('g',{transform:'translate('+g+', '+h+')'},React.createElement(GraphLine,{x1:0,y1:0,x2:0,y2:j,consul:d,active:e}),m,React.createElement(GraphButtonRect,{height:j,onClick:b,onKeyDown:b,width:i,role:'button',tabIndex:100+c}))};NodeButton.propTypes={index:PropTypes.number.isRequired,onButtonClick:PropTypes.func.isRequired,isConsul:PropTypes.bool,instancesActive:PropTypes.bool};export default NodeButton;
import React from'react';import PropTypes from'prop-types';import Constants from'../constants';import{GraphLine,GraphSubtitle}from'./shapes';import GraphNodeInfo from'./info';var GraphNodeContent=function(a){var b=a.child,c=b!==void 0&&b,d=a.data,e=a.y,f=e===void 0?Constants.contentRect.y:e,g=a.index,h=g===void 0?0:g,i=Constants.contentRect,j=i.x,k=i.width,l=c?{x:Constants.infoPosition.x,y:Constants.infoPosition.y+21}:Constants.infoPosition,m=c?React.createElement(GraphSubtitle,Object.assign({},Constants.subtitlePosition,{consul:d.isConsul,active:d.instancesActive}),d.name):null,n=React.createElement(GraphNodeInfo,{data:d,pos:l});return React.createElement('g',{transform:'translate('+j+', '+f+')'},React.createElement(GraphLine,{x1:0,y1:0,x2:k,y2:0,consul:d.isConsul,active:d.instancesActive}),m,n)};GraphNodeContent.propTypes={child:PropTypes.bool,data:PropTypes.object.isRequired,index:PropTypes.number};export default GraphNodeContent;
import React from'react';import PropTypes from'prop-types';import Constants from'../constants';import{getContentRect}from'../functions';import GraphNodeTitle from'./title';import GraphNodeButton from'./button';import GraphNodeContent from'./content';import{GraphNodeRect,GraphShadowRect}from'./shapes';var GraphNode=function(a){var b=a.data,c=a.index,d=a.onDragStart,e=a.onNodeTitleClick,f=a.onQuickActions,g=b.nodeRect,h=g.left,i=g.top,j=g.width,k=g.height,l=b.connected,m=b.id,n=b.children,o=b.instancesActive,p=b.isConsul,q=b.x,r=b.y;l&&(q=b.x+h,r=b.y+i);var s=function(a){a.preventDefault(),d(a,m)},t=l?{onMouseDown:s,onTouchStart:s}:{},u=n?n.reduce(function(a,b,c){return a.children.push(React.createElement(GraphNodeContent,{key:c,child:!0,data:b,index:c,y:a.y})),a.y+=getContentRect(b,!0).height,a},{y:Constants.contentRect.y,children:[]}).children:React.createElement(GraphNodeContent,{data:b}),v=o?React.createElement(GraphShadowRect,{x:0,y:3,width:j,height:k,consul:p,active:o}):null;return React.createElement('g',{transform:'translate('+q+', '+r+')'},v,React.createElement(GraphNodeRect,Object.assign({x:0,y:0,width:j,height:k,consul:p,active:o,connected:l},t)),React.createElement(GraphNodeTitle,{data:b,onNodeTitleClick:function onTitleClick(a){return e(a,{service:b})}}),React.createElement(GraphNodeButton,{index:c,onButtonClick:function onButtonClick(a){var c={x:b.x+Constants.buttonRect.x+Constants.buttonRect.width/2,y:b.y+Constants.buttonRect.y+Constants.buttonRect.height};l&&(c.x+=h,c.y+=i);var e={service:b,position:{left:c.x,top:c.y}};f&&f(a,e)},isConsul:p,instancesActive:o}),u)};GraphNode.propTypes={data:PropTypes.object.isRequired,index:PropTypes.number.isRequired,onDragStart:PropTypes.func,onNodeTitleClick:PropTypes.func,onQuickActions:PropTypes.func};export default GraphNode;
var _templateObject=_taggedTemplateLiteral(['\n  fill: ',';\n\n  ',';\n'],['\n  fill: ',';\n\n  ',';\n']),_templateObject2=_taggedTemplateLiteral(['\n    fill: ',';\n  '],['\n    fill: ',';\n  ']),_templateObject3=_taggedTemplateLiteral(['\n  fill: ',';\n\n  ',';\n\n  ',';\n'],['\n  fill: ',';\n\n  ',';\n\n  ',';\n']);function _taggedTemplateLiteral(a,b){return Object.freeze(Object.defineProperties(a,{raw:{value:Object.freeze(b)}}))}import React from'react';import styled from'styled-components';import is,{isNot}from'styled-is';import PropTypes from'prop-types';import{Point}from'../prop-types';import{GraphText}from'./shapes';import{HealthyIcon,theme,InstancesIcon,InstancesIconLight}from'joyent-ui-toolkit';var StyledInstancesIcon=styled(InstancesIcon)(_templateObject,theme.secondary,isNot('active')(_templateObject2,theme.secondary)),StyledHealthyIcon=styled(HealthyIcon)(_templateObject3,theme.orange,is('healthy')(_templateObject2,theme.green),is('unhealthy')(_templateObject2,theme.red)),GraphNodeInfo=function(a){var b=a.data,c=a.pos,d=b.instances,e=b.instanceStatuses,f=b.instancesHealthy,g=b.isConsul,h=b.instancesActive,i=b.transitionalStatus,j=b.status,k=c.x,l=c.y,m=i?React.createElement(GraphText,{consul:g,active:h},j.toLowerCase()):e.map(function(a,b){return React.createElement(GraphText,{key:b,consul:g,active:h},a.count+'\n            '+a.status.toLowerCase())}),n=React.createElement(StyledHealthyIcon,{healthy:f&&f.total===f.healthy?'HEALTHY':'UNHEALTHY'});return React.createElement('g',{transform:'translate('+k+', '+l+')'},React.createElement('g',{transform:'translate(0, 0)'},n),React.createElement('g',{transform:'translate(30, 4.5)'},g?React.createElement(StyledInstancesIcon,{active:h}):React.createElement(InstancesIconLight,null)),React.createElement(GraphText,{x:54,y:14,consul:g,active:h},d.length+' inst.'),React.createElement('g',{transform:'translate(54, 36)'},m))};GraphNodeInfo.propTypes={data:PropTypes.object.isRequired,pos:Point.isRequired};export default GraphNodeInfo;
import React from'react';import{Point}from'../prop-types';import{GraphText}from'./shapes';import PropTypes from'prop-types';var GraphNodeMetrics=function(a){var b=a.connected,c=a.metrics,d=a.pos,e=d.x,f=d.y,g=c.map(function(a,c){return React.createElement(GraphText,{key:c,x:0,y:12+18*c,connected:b},a.name+': '+a.value)});return React.createElement('g',{transform:'translate('+e+', '+f+')'},g)};GraphNodeMetrics.propTypes={connected:PropTypes.bool,metrics:PropTypes.arrayOf(PropTypes.shape({name:PropTypes.string.isRequired,value:PropTypes.string.isRequired})),pos:Point.isRequired};export default GraphNodeMetrics;
var _templateObject=_taggedTemplateLiteral(['\n  stroke: ',';\n  stroke-width: 1.5;\n\n  ',';\n\n  ',';\n'],['\n  stroke: ',';\n  stroke-width: 1.5;\n\n  ',';\n\n  ',';\n']),_templateObject2=_taggedTemplateLiteral(['\n    stroke: ',';\n  '],['\n    stroke: ',';\n  ']),_templateObject3=_taggedTemplateLiteral(['\n  fill: ',';\n  stroke: ',';\n  stroke-width: 1.5;\n  rx: 4;\n  ry: 4;\n\n  ',';\n\n  ',';\n\n  ',';\n'],['\n  fill: ',';\n  stroke: ',';\n  stroke-width: 1.5;\n  rx: 4;\n  ry: 4;\n\n  ',';\n\n  ',';\n\n  ',';\n']),_templateObject4=_taggedTemplateLiteral(['\n    stroke: ',';\n    fill: ',';\n  '],['\n    stroke: ',';\n    fill: ',';\n  ']),_templateObject5=_taggedTemplateLiteral(['\n    cursor: move;\n  '],['\n    cursor: move;\n  ']),_templateObject6=_taggedTemplateLiteral(['\n  fill: ',';\n  opacity: 0.33;\n  rx: 4;\n  ry: 4;\n\n  ',';\n'],['\n  fill: ',';\n  opacity: 0.33;\n  rx: 4;\n  ry: 4;\n\n  ',';\n']),_templateObject7=_taggedTemplateLiteral(['\n    fill: ',';\n  '],['\n    fill: ',';\n  ']),_templateObject8=_taggedTemplateLiteral(['\n  font-weight: normal;\n\n  font-size: 16px;\n  font-weight: 600;\n  fill: ',';\n\n  ',';\n\n  ',';\n\n  cursor: pointer;\n'],['\n  font-weight: normal;\n\n  font-size: 16px;\n  font-weight: 600;\n  fill: ',';\n\n  ',';\n\n  ',';\n\n  cursor: pointer;\n']),_templateObject9=_taggedTemplateLiteral(['\n  font-weight: normal;\n\n  font-size: 12px;\n  font-weight: 600;\n  fill: ',';\n\n  ',';\n\n  ',';\n'],['\n  font-weight: normal;\n\n  font-size: 12px;\n  font-weight: 600;\n  fill: ',';\n\n  ',';\n\n  ',';\n']),_templateObject10=_taggedTemplateLiteral(['\n  font-weight: normal;\n\n  font-size: 12px;\n  fill: ',';\n  opacity: 0.8;\n\n  ',';\n\n  ',';\n'],['\n  font-weight: normal;\n\n  font-size: 12px;\n  fill: ',';\n  opacity: 0.8;\n\n  ',';\n\n  ',';\n']),_templateObject11=_taggedTemplateLiteral(['\n  cursor: pointer;\n  opacity: 0;\n\n  &:focus {\n    outline: none;\n  }\n'],['\n  cursor: pointer;\n  opacity: 0;\n\n  &:focus {\n    outline: none;\n  }\n']),_templateObject12=_taggedTemplateLiteral(['\n  fill: ',';\n\n  ',';\n\n  ',';\n'],['\n  fill: ',';\n\n  ',';\n\n  ',';\n']),_templateObject13=_taggedTemplateLiteral(['\n  fill: ',';\n'],['\n  fill: ',';\n']);function _taggedTemplateLiteral(a,b){return Object.freeze(Object.defineProperties(a,{raw:{value:Object.freeze(b)}}))}import styled from'styled-components';import is,{isNot}from'styled-is';import{theme}from'joyent-ui-toolkit';export var GraphLine=styled.line(_templateObject,theme.secondaryActive,is('consul')(_templateObject2,theme.grey),isNot('active')(_templateObject2,theme.grey));export var GraphNodeRect=styled.rect(_templateObject3,theme.secondary,theme.secondaryActive,is('consul')(_templateObject4,theme.grey,theme.white),isNot('active')(_templateObject4,theme.grey,theme.whiteActive),is('connected')(_templateObject5));export var GraphShadowRect=styled.rect(_templateObject6,theme.secondary,is('consul')(_templateObject7,theme.grey));export var GraphTitle=styled.text(_templateObject8,theme.white,is('consul')(_templateObject7,theme.secondary),isNot('active')(_templateObject7,theme.secondary));export var GraphSubtitle=styled.text(_templateObject9,theme.white,is('consul')(_templateObject7,theme.secondary),isNot('active')(_templateObject7,theme.secondary));export var GraphText=styled.text(_templateObject10,theme.white,is('consul')(_templateObject7,theme.secondary),isNot('active')(_templateObject7,theme.secondary));export var GraphButtonRect=styled.rect(_templateObject11);export var GraphButtonCircle=styled.circle(_templateObject12,theme.white,is('consul')(_templateObject7,theme.secondary),isNot('active')(_templateObject7,theme.secondary));export var GraphHealthyCircle=styled.circle(_templateObject13,theme.green);
import React from'react';import PropTypes from'prop-types';import Constants from'../constants';import{GraphTitle}from'./shapes';var GraphNodeTitle=function(a){var b=a.data,c=a.onNodeTitleClick;return React.createElement('g',null,React.createElement(GraphTitle,{x:Constants.paddingLeft,y:30,onClick:c,onKeyDown:c,consul:b.isConsul,active:b.instancesActive},b.name))};GraphNodeTitle.propTypes={data:PropTypes.object.isRequired,onNodeTitleClick:PropTypes.func};export default GraphNodeTitle;
import PropTypes from'prop-types';var p={x:PropTypes.number.isRequired,y:PropTypes.number.isRequired},s={width:PropTypes.number,height:PropTypes.number},Point=PropTypes.shape(Object.assign({},p)),Size=PropTypes.shape(Object.assign({},s)),Rect=PropTypes.shape(Object.assign({},p,s));export{Point,Rect,Size};
import{forceSimulation,forceLink,forceCollide,forceCenter}from'd3';import Constants from'./constants';var hypotenuse=function(c,a){return Math.sqrt(c*c+a*a)},rectRadius=function(a){var b=a.width,c=a.height;return Math.round(hypotenuse(b,c)/2)},forcePlayAnimation=function(a){for(var b=Math.log,c=Math.ceil(b(a.alphaMin())/b(1-a.alphaDecay()))+100,d=0;d<c;++d)a.tick()},createLinks=function(a){return a.reduce(function(b,c){return c.connections?b.concat(c.connections.reduce(function(b,d){var e=a.filter(function(a){return a.id===d}).length;return e&&b.push({source:c.id,target:d}),b},[])):b},[])},createSimulation=function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,d=a.map(function(a,b){return{id:a.id,index:b}}),e=createLinks(a),f=b.width,g=b.height,h=rectRadius(Constants.nodeSizeWithChildren),i=forceSimulation(d).force('link',forceLink(e).id(function(a){return a.id})).force('collide',forceCollide(h)).force('center',forceCenter(f/2,g/2));return forcePlayAnimation(i,c),{nodes:d,links:e,simulation:i}},updateSimulation=function(a,b,c,d,e,f,g){var h=b.map(function(a,b){var d=c.reduce(function(b,c){return a.id===c.id?c:b},null);return d?{id:d.id,index:b}:{id:a.id,index:b}}),i=createLinks(b),j=e.width,k=e.height,l=rectRadius(Constants.nodeSizeWithChildren);return{simulation:forceSimulation(h).force('link',forceLink(i).id(function(a){return a.id})).force('collide',forceCollide(l)).force('center',forceCenter(j/2,k/2)).on('tick',f).on('end',g),nodes:h,links:i}};export{createSimulation,updateSimulation};
