'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.calculateLineLayout = exports.getNodeRect = exports.getContentRect = undefined;

var _constants = require('./constants');

var _constants2 = _interopRequireDefault(_constants);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const getAngleFromPoints = (source, target) => {
  const lineAngle = Math.atan2(target.y - source.y, target.x - source.x);
  const lineAngleDeg = lineAngle * 180 / Math.PI;
  const zeroToThreeSixty = lineAngleDeg < 0 ? 360 + lineAngleDeg : lineAngleDeg;

  return zeroToThreeSixty;
};

const getPosition = (angle, positions, position, noCorners = false) => {
  const positionIndex = noCorners ? Math.round(angle / 90) * 2 : Math.round(angle / 45);

  const offsetPosition = positions[positionIndex];

  return {
    id: offsetPosition.id,
    x: position.x + offsetPosition.x,
    y: position.y + offsetPosition.y
  };
};

const getPositions = (rect, halfCorner = 0) => [{
  id: 'r',
  x: rect.right,
  y: 0
}, {
  id: 'br',
  x: rect.right - halfCorner,
  y: rect.bottom - halfCorner
}, {
  id: 'b',
  x: 0,
  y: rect.bottom
}, {
  id: 'bl',
  x: rect.left + halfCorner,
  y: rect.bottom - halfCorner
}, {
  id: 'l',
  x: rect.left,
  y: 0
}, {
  id: 'tl',
  x: rect.left + halfCorner,
  y: rect.top + halfCorner
}, {
  id: 't',
  x: 0,
  y: rect.top
}, {
  id: 'tr',
  x: rect.right - halfCorner,
  y: rect.top + halfCorner
}, {
  id: 'r',
  x: rect.right,
  y: 0
}];

const calculateLineLayout = ({ source, target }) => {
  // Actually, this will need to be got dynamically, in case them things are different sizes
  // yeah right, now you'll get to do exactly that

  const halfCorner = 2;

  const sourcePositions = getPositions(source.nodeRect, halfCorner);
  const sourceAngle = getAngleFromPoints(source, target);
  const sourcePosition = getPosition(sourceAngle, sourcePositions, source);

  const targetPositions = getPositions(target.nodeRect, halfCorner);
  const targetAngle = getAngleFromPoints(target, sourcePosition);
  const targetPosition = getPosition(targetAngle, targetPositions, target); // , true);

  const arrowAngle = getAngleFromPoints(sourcePosition, targetPosition);

  return {
    source,
    target,
    sourcePosition,
    targetPosition,
    arrowAngle
  };
};

const getStatusesLength = data => data.transitionalStatus ? 1 : data.instanceStatuses.length;

const getStatusesHeight = data => {
  const statuses = data.children ? data.children.reduce((statuses, child) => statuses + getStatusesLength(child), 0) : getStatusesLength(data);

  return statuses ? _constants2.default.statusHeight * statuses + 6 : 0;
};

const getContentRect = (data, isChild = false) => {
  const contentSize = isChild ? _constants2.default.childContentSize : _constants2.default.contentSize;

  const { height } = contentSize;
  const contentHeight = height + getStatusesHeight(data);

  return Object.assign({}, _constants2.default.contentPosition, {
    width: contentSize.width,
    height: contentHeight
  });
};

const getNodeRect = data => {
  const nodeSize = data.children ? _constants2.default.nodeSizeWithChildren : _constants2.default.nodeSize;

  const { width, height } = nodeSize;
  const nodeHeight = height + getStatusesHeight(data);

  return {
    left: -width / 2,
    right: width / 2,
    top: -height / 2,
    bottom: nodeHeight - height / 2,
    width,
    height: nodeHeight
  };
};

exports.getContentRect = getContentRect;
exports.getNodeRect = getNodeRect;
exports.calculateLineLayout = calculateLineLayout;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9mdW5jdGlvbnMuanMiXSwibmFtZXMiOlsiZ2V0QW5nbGVGcm9tUG9pbnRzIiwic291cmNlIiwidGFyZ2V0IiwibGluZUFuZ2xlIiwiTWF0aCIsImF0YW4yIiwieSIsIngiLCJsaW5lQW5nbGVEZWciLCJQSSIsInplcm9Ub1RocmVlU2l4dHkiLCJnZXRQb3NpdGlvbiIsImFuZ2xlIiwicG9zaXRpb25zIiwicG9zaXRpb24iLCJub0Nvcm5lcnMiLCJwb3NpdGlvbkluZGV4Iiwicm91bmQiLCJvZmZzZXRQb3NpdGlvbiIsImlkIiwiZ2V0UG9zaXRpb25zIiwicmVjdCIsImhhbGZDb3JuZXIiLCJyaWdodCIsImJvdHRvbSIsImxlZnQiLCJ0b3AiLCJjYWxjdWxhdGVMaW5lTGF5b3V0Iiwic291cmNlUG9zaXRpb25zIiwibm9kZVJlY3QiLCJzb3VyY2VBbmdsZSIsInNvdXJjZVBvc2l0aW9uIiwidGFyZ2V0UG9zaXRpb25zIiwidGFyZ2V0QW5nbGUiLCJ0YXJnZXRQb3NpdGlvbiIsImFycm93QW5nbGUiLCJnZXRTdGF0dXNlc0xlbmd0aCIsImRhdGEiLCJ0cmFuc2l0aW9uYWxTdGF0dXMiLCJpbnN0YW5jZVN0YXR1c2VzIiwibGVuZ3RoIiwiZ2V0U3RhdHVzZXNIZWlnaHQiLCJzdGF0dXNlcyIsImNoaWxkcmVuIiwicmVkdWNlIiwiY2hpbGQiLCJzdGF0dXNIZWlnaHQiLCJnZXRDb250ZW50UmVjdCIsImlzQ2hpbGQiLCJjb250ZW50U2l6ZSIsImNoaWxkQ29udGVudFNpemUiLCJoZWlnaHQiLCJjb250ZW50SGVpZ2h0IiwiY29udGVudFBvc2l0aW9uIiwid2lkdGgiLCJnZXROb2RlUmVjdCIsIm5vZGVTaXplIiwibm9kZVNpemVXaXRoQ2hpbGRyZW4iLCJub2RlSGVpZ2h0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7Ozs7OztBQUVBLE1BQU1BLHFCQUFxQixDQUFDQyxNQUFELEVBQVNDLE1BQVQsS0FBb0I7QUFDN0MsUUFBTUMsWUFBWUMs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QUFULEtBQW9CSyxRQUExQjtBQUNBLFFBQU1FLGFBQWFQLFNBQVNWLGtCQUFrQkosSUFBbEIsQ0FBNUI7O0FBRUEsU0FBTztBQUNMWixVQUFNLENBQUM2QixLQUFELEdBQVMsQ0FEVjtBQUVML0IsV0FBTytCLFFBQVEsQ0FGVjtBQUdMNUIsU0FBSyxDQUFDeUIsTUFBRCxHQUFVLENBSFY7QUFJTDNCLFlBQVFrQyxhQUFhUCxTQUFTLENBSnpCO0FBS0xHLFNBTEs7QUFNTEgsWUFBUU87QUFOSCxHQUFQO0FBUUQsQ0FoQkQ7O1FBa0JTWCxjLEdBQUFBLGM7UUFBZ0JRLFcsR0FBQUEsVztRQUFhNUIsbUIsR0FBQUEsbUIiLCJmaWxlIjoiZnVuY3Rpb25zLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENvbnN0YW50cyBmcm9tICcuL2NvbnN0YW50cyc7XG5cbmNvbnN0IGdldEFuZ2xlRnJvbVBvaW50cyA9IChzb3VyY2UsIHRhcmdldCkgPT4ge1xuICBjb25zdCBsaW5lQW5nbGUgPSBNYXRoLmF0YW4yKHRhcmdldC55IC0gc291cmNlLnksIHRhcmdldC54IC0gc291cmNlLngpO1xuICBjb25zdCBsaW5lQW5nbGVEZWcgPSBsaW5lQW5nbGUgKiAxODAgLyBNYXRoLlBJO1xuICBjb25zdCB6ZXJvVG9UaHJlZVNpeHR5ID0gbGluZUFuZ2xlRGVnIDwgMCA/IDM2MCArIGxpbmVBbmdsZURlZyA6IGxpbmVBbmdsZURlZztcblxuICByZXR1cm4gemVyb1RvVGhyZWVTaXh0eTtcbn07XG5cbmNvbnN0IGdldFBvc2l0aW9uID0gKGFuZ2xlLCBwb3NpdGlvbnMsIHBvc2l0aW9uLCBub0Nvcm5lcnMgPSBmYWxzZSkgPT4ge1xuICBjb25zdCBwb3NpdGlvbkluZGV4ID0gbm9Db3JuZXJzXG4gICAgPyBNYXRoLnJvdW5kKGFuZ2xlIC8gOTApICogMlxuICAgIDogTWF0aC5yb3VuZChhbmdsZSAvIDQ1KTtcblxuICBjb25zdCBvZmZzZXRQb3NpdGlvbiA9IHBvc2l0aW9uc1twb3NpdGlvbkluZGV4XTtcblxuICByZXR1cm4ge1xuICAgIGlkOiBvZmZzZXRQb3NpdGlvbi5pZCxcbiAgICB4OiBwb3NpdGlvbi54ICsgb2Zmc2V0UG9zaXRpb24ueCxcbiAgICB5OiBwb3NpdGlvbi55ICsgb2Zmc2V0UG9zaXRpb24ueVxuICB9O1xufTtcblxuY29uc3QgZ2V0UG9zaXRpb25zID0gKHJlY3QsIGhhbGZDb3JuZXIgPSAwKSA9PiBbXG4gIHtcbiAgICBpZDogJ3InLFxuICAgIHg6IHJlY3QucmlnaHQsXG4gICAgeTogMFxuICB9LFxuICB7XG4gICAgaWQ6ICdicicsXG4gICAgeDogcmVjdC5yaWdodCAtIGhhbGZDb3JuZXIsXG4gICAgeTogcmVjdC5ib3R0b20gLSBoYWxmQ29ybmVyXG4gIH0sXG4gIHtcbiAgICBpZDogJ2InLFxuICAgIHg6IDAsXG4gICAgeTogcmVjdC5ib3R0b21cbiAgfSxcbiAge1xuICAgIGlkOiAnYmwnLFxuICAgIHg6IHJlY3QubGVmdCArIGhhbGZDb3JuZXIsXG4gICAgeTogcmVjdC5ib3R0b20gLSBoYWxmQ29ybmVyXG4gIH0sXG4gIHtcbiAgICBpZDogJ2wnLFxuICAgIHg6IHJlY3QubGVmdCxcbiAgICB5OiAwXG4gIH0sXG4gIHtcbiAgICBpZDogJ3RsJyxcbiAgICB4OiByZWN0LmxlZnQgKyBoYWxmQ29ybmVyLFxuICAgIHk6IHJlY3QudG9wICsgaGFsZkNvcm5lclxuICB9LFxuICB7XG4gICAgaWQ6ICd0JyxcbiAgICB4OiAwLFxuICAgIHk6IHJlY3QudG9wXG4gIH0sXG4gIHtcbiAgICBpZDogJ3RyJyxcbiAgICB4OiByZWN0LnJpZ2h0IC0gaGFsZkNvcm5lcixcbiAgICB5OiByZWN0LnRvcCArIGhhbGZDb3JuZXJcbiAgfSxcbiAge1xuICAgIGlkOiAncicsXG4gICAgeDogcmVjdC5yaWdodCxcbiAgICB5OiAwXG4gIH1cbl07XG5cbmNvbnN0IGNhbGN1bGF0ZUxpbmVMYXlvdXQgPSAoeyBzb3VyY2UsIHRhcmdldCB9KSA9PiB7XG4gIC8vIEFjdHVhbGx5LCB0aGlzIHdpbGwgbmVlZCB0byBiZSBnb3QgZHluYW1pY2FsbHksIGluIGNhc2UgdGhlbSB0aGluZ3MgYXJlIGRpZmZlcmVudCBzaXplc1xuICAvLyB5ZWFoIHJpZ2h0LCBub3cgeW91J2xsIGdldCB0byBkbyBleGFjdGx5IHRoYXRcblxuICBjb25zdCBoYWxmQ29ybmVyID0gMjtcblxuICBjb25zdCBzb3VyY2VQb3NpdGlvbnMgPSBnZXRQb3NpdGlvbnMoc291cmNlLm5vZGVSZWN0LCBoYWxmQ29ybmVyKTtcbiAgY29uc3Qgc291cmNlQW5nbGUgPSBnZXRBbmdsZUZyb21Qb2ludHMoc291cmNlLCB0YXJnZXQpO1xuICBjb25zdCBzb3VyY2VQb3NpdGlvbiA9IGdldFBvc2l0aW9uKHNvdXJjZUFuZ2xlLCBzb3VyY2VQb3NpdGlvbnMsIHNvdXJjZSk7XG5cbiAgY29uc3QgdGFyZ2V0UG9zaXRpb25zID0gZ2V0UG9zaXRpb25zKHRhcmdldC5ub2RlUmVjdCwgaGFsZkNvcm5lcik7XG4gIGNvbnN0IHRhcmdldEFuZ2xlID0gZ2V0QW5nbGVGcm9tUG9pbnRzKHRhcmdldCwgc291cmNlUG9zaXRpb24pO1xuICBjb25zdCB0YXJnZXRQb3NpdGlvbiA9IGdldFBvc2l0aW9uKHRhcmdldEFuZ2xlLCB0YXJnZXRQb3NpdGlvbnMsIHRhcmdldCk7IC8vICwgdHJ1ZSk7XG5cbiAgY29uc3QgYXJyb3dBbmdsZSA9IGdldEFuZ2xlRnJvbVBvaW50cyhzb3VyY2VQb3NpdGlvbiwgdGFyZ2V0UG9zaXRpb24pO1xuXG4gIHJldHVybiB7XG4gICAgc291cmNlLFxuICAgIHRhcmdldCxcbiAgICBzb3VyY2VQb3NpdGlvbixcbiAgICB0YXJnZXRQb3NpdGlvbixcbiAgICBhcnJvd0FuZ2xlXG4gIH07XG59O1xuXG5jb25zdCBnZXRTdGF0dXNlc0xlbmd0aCA9IGRhdGEgPT5cbiAgZGF0YS50cmFuc2l0aW9uYWxTdGF0dXMgPyAxIDogZGF0YS5pbnN0YW5jZVN0YXR1c2VzLmxlbmd0aDtcblxuY29uc3QgZ2V0U3RhdHVzZXNIZWlnaHQgPSBkYXRhID0+IHtcbiAgY29uc3Qgc3RhdHVzZXMgPSBkYXRhLmNoaWxkcmVuXG4gICAgPyBkYXRhLmNoaWxkcmVuLnJlZHVjZShcbiAgICAgICAgKHN0YXR1c2VzLCBjaGlsZCkgPT4gc3RhdHVzZXMgKyBnZXRTdGF0dXNlc0xlbmd0aChjaGlsZCksXG4gICAgICAgIDBcbiAgICAgIClcbiAgICA6IGdldFN0YXR1c2VzTGVuZ3RoKGRhdGEpO1xuXG4gIHJldHVybiBzdGF0dXNlcyA/IENvbnN0YW50cy5zdGF0dXNIZWlnaHQgKiBzdGF0dXNlcyArIDYgOiAwO1xufTtcblxuY29uc3QgZ2V0Q29udGVudFJlY3QgPSAoZGF0YSwgaXNDaGlsZCA9IGZhbHNlKSA9PiB7XG4gIGNvbnN0IGNvbnRlbnRTaXplID0gaXNDaGlsZFxuICAgID8gQ29uc3RhbnRzLmNoaWxkQ29udGVudFNpemVcbiAgICA6IENvbnN0YW50cy5jb250ZW50U2l6ZTtcblxuICBjb25zdCB7IGhlaWdodCB9ID0gY29udGVudFNpemU7XG4gIGNvbnN0IGNvbnRlbnRIZWlnaHQgPSBoZWlnaHQgKyBnZXRTdGF0dXNlc0hlaWdodChkYXRhKTtcblxuICByZXR1cm4ge1xuICAgIC4uLkNvbnN0YW50cy5jb250ZW50UG9zaXRpb24sXG4gICAgd2lkdGg6IGNvbnRlbnRTaXplLndpZHRoLFxuICAgIGhlaWdodDogY29udGVudEhlaWdodFxuICB9O1xufTtcblxuY29uc3QgZ2V0Tm9kZVJlY3QgPSBkYXRhID0+IHtcbiAgY29uc3Qgbm9kZVNpemUgPSBkYXRhLmNoaWxkcmVuXG4gICAgPyBDb25zdGFudHMubm9kZVNpemVXaXRoQ2hpbGRyZW5cbiAgICA6IENvbnN0YW50cy5ub2RlU2l6ZTtcblxuICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IG5vZGVTaXplO1xuICBjb25zdCBub2RlSGVpZ2h0ID0gaGVpZ2h0ICsgZ2V0U3RhdHVzZXNIZWlnaHQoZGF0YSk7XG5cbiAgcmV0dXJuIHtcbiAgICBsZWZ0OiAtd2lkdGggLyAyLFxuICAgIHJpZ2h0OiB3aWR0aCAvIDIsXG4gICAgdG9wOiAtaGVpZ2h0IC8gMixcbiAgICBib3R0b206IG5vZGVIZWlnaHQgLSBoZWlnaHQgLyAyLFxuICAgIHdpZHRoLFxuICAgIGhlaWdodDogbm9kZUhlaWdodFxuICB9O1xufTtcblxuZXhwb3J0IHsgZ2V0Q29udGVudFJlY3QsIGdldE5vZGVSZWN0LCBjYWxjdWxhdGVMaW5lTGF5b3V0IH07XG4iXX0=